<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>FediAlgo Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><!-- [![Fedialgo Build and Test](https://github.com/pkreissel/fedialgo/actions/workflows/CI.yaml/badge.svg)](https://github.com/pkreissel/fedialgo/actions/workflows/CI.yaml) -->
<h1><code>fedialgo</code></h1>
<p>Fedialgo is a <code>node.js</code> library offering a customizable algorithm for the federated social media platform <a href="https://joinmastodon.org/">Mastodon</a> that can free you from the tyranny of Mastodon's reverse chronological order timeline. It's based on <a href="https://github.com/pkreissel/fedialgo">pkreissel's original implementation</a> and ideas though it has more or less been completely rewritten and has many more features like integration of trending toots,filtering of the feed, improved load times, and more.</p>
<ul>
<li>Try the demo app <a href="https://michelcrypt4d4mus.github.io/fedialgo_demo_app_foryoufeed/">here</a>! (code for the demo app is <a href="https://github.com/michelcrypt4d4mus/fedialgo_demo_app_foryoufeed">here</a>).</li>
<li>Video of the demo in action <a href="https://www.youtube.com/watch?v=tR35bUHzJdk">on YouTube</a>.</li>
<li>Fedialgo <a href="https://michelcrypt4d4mus.github.io/fedialgo/">objects and types documentation</a></li>
</ul>
<h1>Installation</h1>
<p>You can install this library from github with <code>npm</code>:</p>
<pre class="prettyprint source lang-bash"><code>npm install --save github:michelcrypt4d4mus/fedialgo
</code></pre>
<p>Or with <code>yarn</code>:</p>
<pre class="prettyprint source lang-bash"><code>yarn add https://github.com/michelcrypt4d4mus/fedialgo
</code></pre>
<h3>Troubleshooting</h3>
<p>If you're using the library outside a browser and get a <code>Buffer is not a function</code> error you may also need the <code>buffer</code> package to simulate the one provided by most browsers. It's required by the <code>class-transformer</code> library FediAlgo uses to serialize data to browser storage.</p>
<pre class="prettyprint source lang-bash"><code>npm install --save buffer
</code></pre>
<p>And then put this in your main entrypoint (e.g. <code>App.tsx</code> or something like that):</p>
<pre class="prettyprint source lang-typescript"><code>import { Buffer } from 'buffer'; // Required for class-transformer to work
(window as any).Buffer = Buffer;
</code></pre>
<h1>Usage</h1>
<p>The demo app's <a href="https://github.com/michelcrypt4d4mus/fedialgo_demo_app_foryoufeed/blob/master/src/pages/Feed.tsx"><code>Feed</code> component</a> demonstrates the latest and greatest way to use Fedialgo but here's a quick overview of how to get up and running. This code assumes you already have an access token for a user and a registered Mastodon &quot;application&quot; on the Mastodon server allowing <code>read</code> scope access. If you don't have one see <a href="https://github.com/neet/masto.js/?tab=readme-ov-file#quick-start">the <code>masto.js</code> documentation</a> for how to get one.</p>
<p>The FediAlgo demo app also contains a working example of how to execute the OAuth flow for a user to both register an app and get an authorized OAuth token for them:</p>
<ul>
<li><a href="https://github.com/michelcrypt4d4mus/fedialgo_demo_app_foryoufeed/blob/master/src/pages/LoginPage.tsx">Login page</a></li>
<li><a href="https://github.com/michelcrypt4d4mus/fedialgo_demo_app_foryoufeed/blob/master/src/pages/CallbackPage.tsx">OAuth callback page</a></li>
</ul>
<pre class="prettyprint source lang-typescript"><code>import TheAlgorithm from &quot;fedialgo&quot;
import { createRestAPIClient, mastodon } from &quot;masto&quot;;

const mastodonServer = &quot;https://mastodon.social&quot;;
const accessToken = getTheUserAccessTokenSomehow();
const api = createRestAPIClient({accessToken: accessToken, url: mastodonServer});
const currentUser = await api.v1.accounts.verifyCredentials();

// Instantiate a TheAlgorithm object
const algorithm = await TheAlgorithm.create({
    api: api,
    user: currentUser,
    locale: &quot;en-GB&quot;,     // optional (available in navigator.language in browser)
});
</code></pre>
<h3>The <code>setTimelineInApp</code> Callback</h3>
<p>You are encouraged to pass an optional <code>setTimelineInApp()</code> callback to <code>TheAlgorithm.create()</code> and allow FediAlgo to manage the state of the timeline in your app. The callback will be invoked whenever the timeline is updated. More specifically it will be invoked when any of these things happen:</p>
<ul>
<li>A batch of toots is retrieved from the fediverse and integrated into the timeline</li>
<li>You make a call to <code>algorithm.updateUserWeights()</code> (see below)</li>
<li>You make a call to <code>algorithm.updateFilters()</code> (see below)</li>
<li>A background data fetch incrementally loads more of the user's historical data (as the algorithm is responsive to the user's history of favourites, retoots, etc. additional data can reorder the feed slightly)</li>
</ul>
<p>An example involving storing the timeline in a React component's state:</p>
<pre class="prettyprint source lang-typescript"><code>import { useState } from React;
import TheAlgorithm, { Toot } from &quot;fedialgo&quot;

const [timeline, setTimeline] = useState&lt;Toot[]>([]);

const algorithm = await TheAlgorithm.create({
    api: api,
    user: currentUser,
    setTimelineInApp: setTimeline
});
</code></pre>
<h2>Functionality</h2>
<p>Once you've instantiated a <code>TheAlgorithm</code> object there's three primary ways of interacting with it:</p>
<h4>Triggering Construction Of The Timeline</h4>
<pre class="prettyprint source lang-typescript"><code>import { Toot } from &quot;fedialgo&quot;;

// Trigger the feed builder. FediAlgo will start doing stuff asynchronously. If you passed
// setTimelineInApp in the constructor all you need to do is monitor the state of whatever
// variable contains the timeline (in the React example above that would be 'timeline').
algorithm.triggerFeedUpdate();

// After first invocation check if loading is in progress before calling to avoid exceptions
if (!algorithm.isLoading) {
    algorithm.triggerFeedUpdate();
}

// algorithm.timeline returns the current weight-ordered/filtered array of Toot objects
// Note there won't be anything there until the timeilne is at least partially built!
let timeline: Toot[] = algorithm.timeline;
// If you wanted to wait until the feed was fully constructed, wait for the Promise:
algorithm.triggerFeedUpdate().then(() => timeline = algorithm.timeline);

// You can pull additional past timeline toots beyond the configured initial amount:
algorithm.triggerHomeTimelineBackFill();
</code></pre>
<h4>Setting Weights For The Various Feed Scorers</h4>
<pre class="prettyprint source lang-typescript"><code>import { ScoreName, Toot, Weights, WeightPresetLabel } from &quot;fedialgo&quot;;

// Get and set score weightings (the things controlled by the sliders in the demo app)
const weights: Weights = await algorithm.getUserWeights();
weights[ScoreName.NUM_REPLIES] = 0.5;
let timelineFeed: Toot[] = await algorithm.updateUserWeights(weights);

// Additional properties (description, minimum value, etc) can be found at algorithm.weightInfo.
for (const key in algorithm.weightInfo) {
    console.log(`Weight '${key}' info: ${algorithm.weightInfo[key]}`);
}

// Or choose a preset weight configuration using the WeightPresetLabel enum
timelineFeed = await algorithm.updateUserWeightsToPreset(WeightPresetLabel.CHRONOLOGICAL);
// All the presets can be found in algorithm.weightPresets
Object.entries(algorithm.weightPresets).forEach(([presetName, weights]) => {
    console.log(`${presetName}:`, weights)
});
</code></pre>
<h4>Filtering The Feed</h4>
<pre class="prettyprint source lang-typescript"><code>import { BooleanFilterName, ScoreName, TagTootsCacheKey, Toot, Weights } from &quot;fedialgo&quot;;

// Set a filter for only German language toots
algorithm.filters.booleanFilters[BooleanFilterName.LANGUAGE].updateOption(&quot;de&quot;, true);
const filteredFeed: Toot[] = algorithm.updateFilters(filters);

// Set a filter for only toots with at least 3 replies
algorithm.filters.numericFilters[ScoreName.NUM_REPLIES].value = 3;
const filteredFeed: Toot[] = algorithm.updateFilters(filters);

// There's also a lot of information available about the options that can be chosen for each filter
filters.booleanFilters[BooleanFilterName.HASHTAG].options.forEach((option) => {
    console.log(`Tooted the hashtag &quot;${option.name} ${option[TagTootsCacheKey.PARTICIPATED_TAG_TOOTS]} times`);
});
</code></pre>
<h4>Errors</h4>
<p>Most minor API errors will be handled silently so that if, for example, fedialgo only gets half of a user's recent toots or whatever that doesn't cause any issues for the client app. If you want to see what, if any, errors were encountered during the scoring process you can check <code>apiErrorMsgs</code> to find them.</p>
<pre class="prettyprint source lang-typescript"><code>console.log(`API errors:`, algorithm.apiErrorMsgs);
</code></pre>
<h4>Resetting Everything</h4>
<p>You can wipe the browser storage and reset all variables if needed.</p>
<pre class="prettyprint source lang-typescript"><code>// Delete the user's timeline and historical data but preserve the user session
await algorithm.reset();
// Wipe EVERYTHING (will force a logout and complete reauthentication)
await algorithm.reset(true);
</code></pre>
<h2><code>fedialgo</code> Functions And Types Documentation</h2>
<p>There is some documentation of various classes and methods you might want to access while working with <code>fedialgo</code> generated from JSDoc comments in the code available <a href="https://michelcrypt4d4mus.github.io/fedialgo/">here</a>.</p>
<h4><code>Toot</code> Object API</h4>
<p>The timeline is returned as an array of <code>Toot</code> objects which are a minimal extension of the mastodon API's <code>Status</code> object with a few more properties and some helper methods. Check <a href="./src/api/objects/toot.ts"><code>toot.ts</code></a> for details. In particular note that you can mark a <code>Toot</code> object's <code>numTimesShown</code> property, at which point the <code>AlreadyShownScorer</code> will return non-zero values for that Toot.</p>
<pre class="prettyprint source lang-typescript"><code>timelineFeed[0].numTimesShown = 1;
</code></pre>
<h4>Other Data Available From <code>TheAlgorithm</code></h4>
<p>FediAlgo exports a number of types and enums; check <a href="https://michelcrypt4d4mus.github.io/fedialgo/">the documentation</a> or look at the bottom of <a href="src/index.ts"><code>index.ts</code></a> for details on what is available.
<code>TheAlgorithm</code> objects also provide a bunch of data besides the timeline should you choose to access it.</p>
<h4>Fediverse Trending Data</h4>
<p>Current &quot;trending&quot; fediverse data can be accessed at <code>algorithm.trendingData</code>. See <a href="src/types.ts"><code>types.ts</code></a> for info on the data type.</p>
<pre class="prettyprint source lang-typescript"><code>// Trending links
algorithm.trendingData.links.foreach((link) => console.log(`Link '${link.uri}' tooted by ${link.numAccounts} accounts`));

// Trending tags
algorithm.trendingData.tags.foreach((tag) => console.log(`Tag '${tag.name}' tooted by ${tag.numAccounts} accounts`));

// Trending toots
algorithm.trendingData.toots.foreach((toot) => console.log(`Trending toot w/rank ${toot.trendingRank}: '${toot.describe()}'`));

// Popular servers
console.log(`Servers used to determine trending data:`, algorithm.mastodonServers);
</code></pre>
<h4>User Data</h4>
<p>The user's followed accounts, muted accounts, followed tags, and a few other bits and bobs used the compute the weighting in the timeline can be accessed at <code>algorithm.userData</code>. See <a href="src/api/user_data.ts"><code>user_data.ts</code></a> for info on the data type (and be aware this is probably the least stable / most subject to change part of the fedialgo API).</p>
<p>There's also a unified method to collect a bunch of information (<code>fedialgo</code> configuration, server configuration, user data, filter settings, etc.) with a single call:</p>
<pre class="prettyprint source lang-typescript"><code>const currentState = await algorithm.getCurrentState();
</code></pre>
<h2>Package Configuration</h2>
<p>Package configuration options can be found in <a href="src/config.ts"><code>src/config.ts</code></a>. These can't currently be changed via the API though feel free to experiment with your local copy of the repo or ping me if you have a use case for updating some of the configuration variables.</p>
<h1>Contributing</h1>
<h3>Developer Setup</h3>
<p>If necessary install the dev dependencies with <code>npm install --include=dev</code>.</p>
<h3>Debugging</h3>
<p>If you set the environment variable <code>FEDIALGO_DEBUG=true</code> a <em>lot</em> more debugging info will be printed to the browser console. See <a href="./.env.example"><code>.env.example</code></a> for other environment variables you can play with.</p>
<h3>Adding New Scorers</h3>
<p>To add a new metric for scoring toots you must:</p>
<ol>
<li>Add an entry to the <code>ScoreName</code> enum</li>
<li>Create a new subclass of <a href="src/scorer/scorer.ts"><code>Scorer</code></a></li>
<li>Add a default weight for your scorer to <a href="src/scorer/weight_presets.ts"><code>DEFAULT_WEIGHTS</code></a></li>
<li>Instantiate an instance of your new <code>Scorer</code> in the appropriate array in <a href="src/index.ts"><code>TheAlgorithm</code></a> (<code>featureScorers</code> if it's a self contained score that requires only the information in a single toot, <code>feedScorers</code> if it's a scorer that requires the entire set of timeline toots to score a toot)</li>
</ol>
<h3>Deploying Changes</h3>
<p>For changes to propagate you must run <code>npm run build</code> to generate changes to files in <code>dist/</code> and then check those files into git.</p>
<h3>Developing Against a Local Project</h3>
<p>Clone this repo and cd into it. Then run:</p>
<pre class="prettyprint source lang-bash"><code>npm install
npm link
</code></pre>
<p>Then <code>cd</code> to the <code>node.js</code> project that is going to host this package and run this:</p>
<pre class="prettyprint source lang-bash"><code>npm link fedialgo
</code></pre>
<h3>Running Test Suite</h3>
<p>(The test suite is kind of useless unfortnately.)
<s><code>npm run test</code></s></p>
<h3>Miscellaneous</h3>
<p>Use <code>// @ts-ignore</code> if you run into Typescript warnings (because your project might also use <code>masto</code>)</p>
<pre class="prettyprint source lang-bash"><code>npm run build
</code></pre>
<p>in <code>fedialgo</code> directory after changes and they will automatically be detected.</p>
<p>There's a pre-commit git hook that runs <code>npm run build</code> but unfortunately it doesn't seem to actually run <em>before</em> the commit :(</p>
<h3>Resources</h3>
<ul>
<li><a href="https://neet.github.io/masto.js"><code>masto.js</code> documentation</a></li>
<li><a href="https://marcobotto.com/blog/compiling-and-bundling-typescript-libraries-with-webpack/">Compiling and bundling TypeScript libraries with Webpack</a></li>
</ul>
<h1>TODO</h1>
<ol>
<li>Support <a href="https://docs.joinmastodon.org/methods/domain_blocks/">domain level blocks</a></li>
<li>Make use of the fact that you can see who favourited a post: https://docs.joinmastodon.org/methods/statuses/#favourited_by</li>
</ol>
<h3>What's slow:</h3>
<p>According to Chrome profiler it's the retrieval of the user's favourites that is the biggest bottleneck at initial load time. Took ~10 seconds, getting user's old toots took ~5s.</p></article>
    </section>









<section>

<header>
    
        <h2>api/objects/toot.js</h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description">Helper functions and class for dealing with Toot (Mastodon status) objects.
Includes methods for scoring, filtering, deduplication, and property repair.</div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    

    

    
</article>

</section>







<section>

<header>
    
        <h2>enums.js</h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description">Enums used by FediAlgo.</div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    

    

    
</article>

</section>







<section>

<header>
    
        <h2>filters/boolean_filter.js</h2>
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description">Feed filtering information related to a single criterion on which toots
can be filtered inclusively or exclusively based on an array of strings
(e.g. language, hashtag, type of toot).</div>
        

        


<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>


        
    
    </div>

    

    

    

    

    

    

    

    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-collection_helpers.html">collection_helpers</a></li></ul><h3>Classes</h3><ul><li><a href="Account.html">Account</a></li><li><a href="BooleanFilter.html">BooleanFilter</a></li><li><a href="BooleanFilterOptionList.html">BooleanFilterOptionList</a></li><li><a href="MastoApi.html">MastoApi</a></li><li><a href="NumericFilter.html">NumericFilter</a></li><li><a href="ObjWithCountList.html">ObjWithCountList</a></li><li><a href="TagList.html">TagList</a></li><li><a href="TheAlgorithm.html">TheAlgorithm</a></li><li><a href="Toot.html">Toot</a></li><li><a href="TootFilter.html">TootFilter</a></li><li><a href="UserData.html">UserData</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ALL_CACHE_KEYS">ALL_CACHE_KEYS</a></li><li><a href="global.html#AlgorithmStorageKey">AlgorithmStorageKey</a></li><li><a href="global.html#BooleanFilterName">BooleanFilterName</a></li><li><a href="global.html#CacheKey">CacheKey</a></li><li><a href="global.html#MediaCategory">MediaCategory</a></li><li><a href="global.html#NonScoreWeightName">NonScoreWeightName</a></li><li><a href="global.html#ScoreName">ScoreName</a></li><li><a href="global.html#TagTootsCacheKey">TagTootsCacheKey</a></li><li><a href="global.html#TrendingType">TrendingType</a></li><li><a href="global.html#TypeFilterName">TypeFilterName</a></li><li><a href="global.html#isAccessTokenRevokedError">isAccessTokenRevokedError</a></li><li><a href="global.html#isRateLimitError">isRateLimitError</a></li><li><a href="global.html#isTypeFilterName">isTypeFilterName</a></li><li><a href="global.html#isValueInStringEnum">isValueInStringEnum</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.4</a> on Mon Jun 09 2025 17:17:33 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>